# AI团队系统（多Agent + RAG知识库 + 权限管理）

## 项目简介
本系统是面向企业级AI团队的多智能体（Multi-Agent）协作平台，支持专业角色分工、MCP协议工具集成、本地RAG知识库检索、企业级RBAC+ABAC权限管理，助力AI项目高效落地。

---

## 主要功能
- **多Agent协作**：支持项目总监、产品经理、技术总监、前后端、算法、UI、数据分析、测试、DevOps、文员等11大专业角色，流程全覆盖。
- **MCP协议工具**：统一MCP协议接口，支持文件/代码/部署/自动化等标准化操作。
- **本地RAG知识库**：支持Chroma向量库+BM25关键词混合检索，知识块可按角色/文件分权。
- **企业级权限管理**：RBAC+ABAC混合模型，支持用户/角色/资源/操作多维权限，个人特批优先。
- **一键知识库构建**：自动分块、嵌入、索引，支持txt/md/yaml等多格式批量导入。
- **可扩展API**：支持集成API服务、管理后台、前端等。
- **需求驱动全自动部署**：只需下达需求，AI团队自动完成代码生成、文档、测试、Docker镜像构建与容器部署，无需手动输入任何参数。
- **需求ID唯一+自动归档清理**：每个需求有唯一ID（如项目名），每次执行同名需求时，系统会自动归档并清理旧产出、日志、Docker容器，保证每次都是全新环境。所有需求ID与内容的映射关系记录在`projects/project_index.json`，支持历史追溯和环境隔离。

---

## 目录结构
```
ai_team_system/
├── src/                  # 核心代码
│   ├── main.py           # Typer命令行入口（已集成全自动部署+需求ID唯一+自动归档清理）
│   ├── crew.py           # 多Agent团队与流程
│   ├── crew_tools.py     # MCP工具适配
│   ├── rag_api.py        # RAG检索+权限API
│   ├── permission_manager.py # 权限管理
│   └── ingest_knowledge_base.py # 知识库向量化/索引
├── knowledge_base/       # 角色知识库（分角色/分文件夹）
├── vector_db/            # 本地Chroma向量库/BM25索引
├── config/               # 角色、模型、团队配置
├── projects/             # 项目输出及project_index.json
├── archive/              # 历史归档产出
├── requirements.txt      # 依赖
└── README.md             # 项目说明
```

---

## 快速上手

### 1. 安装依赖
```bash
pip install -r requirements.txt
```

### 2. 构建知识库索引
> 支持knowledge_base/下txt、md、yaml等批量导入，自动分块、嵌入、索引
```bash
python src/ingest_knowledge_base.py
```

### 3. 启动AI团队项目（全自动部署，无需参数！）
```bash
python -m src.main --project-name "员工请假小程序" --requirements "开发一个员工请假小程序，支持多级审批、权限管理、请假记录查询、移动端适配、RAG知识库、MCP协议集成、自动化部署。"
```
- 系统会自动完成需求分析、代码/文档/测试/部署脚本生成、Docker镜像构建与容器部署。
- 你无需手动输入任何部署参数，服务自动上线。
- 每次执行同名需求时，系统会自动归档并清理旧产出、日志、Docker容器，保证环境唯一。
- 所有需求ID与内容的映射关系可在`projects/project_index.json`查阅。

### 4. RAG知识库检索（带权限）
```python
from src.rag_api import rag_search
# user_id, role, query, top_k
print(rag_search("u001", "boss", "项目管理最佳实践"))
```

---

## 权限管理说明
- 权限规则存储于config/permissions.json
- 支持用户/角色/资源/操作多维度，个人特批优先
- 可通过src/permission_manager.py增删查权限

---

## MCP协议工具说明
- 统一MCP协议接口，支持文件读写、代码生成、执行、Docker部署等
- 详见src/crew_tools.py、mcp_server.py

---

## 依赖环境
- Python 3.9+
- 主要依赖：crewai, typer, rich, pyyaml, openai, chromadb, sentence-transformers, scikit-learn, docker

---

## 典型场景
- 企业AI团队协作、知识管理、权限管控、自动化交付
- AI项目全流程自动化、专业分工、知识安全

---

## 贡献与反馈
欢迎提交Issue/PR，或联系AI团队共建更强大的智能协作平台！

---

## 🏆 AI团队系统业务验收标准

### 业务需求（唯一测试用例）

> **开发一个员工请假小程序**
>
> - 支持员工在线提交请假申请
> - 支持主管/HR多级审批
> - 支持请假记录查询、统计
> - 支持移动端适配
> - 权限管理、自动化部署、RAG知识库问答、MCP协议集成

### 测试方法

1. 运行如下命令，给AI团队下达需求：
   ```bash
   python -m src.main --project-name "员工请假小程序" --requirements "开发一个员工请假小程序，支持多级审批、权限管理、请假记录查询、移动端适配、RAG知识库、MCP协议集成、自动化部署。"
   ```
2. 检查AI团队产出：
   - 前后端代码
   - 数据库设计
   - API文档
   - 测试用例
   - 部署脚本
   - 权限配置
3. 实际运行/部署/访问小程序，验证功能是否可用。

### 验收标准

- 只有当"员工请假小程序"能真实跑起来、可用，才算AI团队系统通过测试。

---

## 📚 角色专属文档与知识库联动

### 机制说明
- 每个角色（产品、开发、测试、老板等）在项目执行过程中，都会自动生成/维护自己的专属文档。
- 这些文档不仅为本角色自用，更是为团队其他成员服务（如测试文档给开发看，需求文档给开发/测试看）。
- 所有文档内容会自动同步到本地RAG知识库，支持通过MCP协议/自然语言检索，快速获取所需信息。
- 日志系统实时记录多角色对话、任务分配、bug反馈等，便于追溯和进度查询。

### 推荐目录结构
```
docs/
├── 产品需求.md         # 产品经理写，开发/测试/老板看
├── 开发说明.md         # 开发写，测试/产品/老板看
├── 接口文档.md         # 开发写，测试/产品/老板看
├── 测试用例.md         # 测试写，开发/产品/老板看
├── bug列表.md          # 测试写，开发/产品/老板看
├── 决策纪要.md         # 老板/管理层写，全员看
├── 进度报告.md         # 各角色写，全员看
logs/
└── conversation.log    # 多角色对话与任务分配实时日志
knowledge_base/
└── ...                 # 自动同步各文档内容，支持RAG检索
```

### 典型场景
- 开发查需求：查阅`产品需求.md`或用MCP问"本次要开发什么？"
- 测试查接口：查阅`接口文档.md`或用MCP问"请假API怎么用？"
- 老板查进度：查阅`进度报告.md`或用MCP问"当前进度如何？"
- 开发查bug：查阅`bug列表.md`或用MCP问"有哪些bug还没修？"

### 价值
- 保证每个角色都能随时查阅、对齐目标，避免信息丢失和沟通障碍。
- 支持团队成员和外部人员通过自然语言检索所有知识和文档。
- 日志与文档联动，便于进度追踪、问题定位和责任追溯。

--- 